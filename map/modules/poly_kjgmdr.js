function bi(a,b){return!a||!b?0:Math.round(Math.sqrt(Math.pow(a.lng-b.lng,2)+Math.pow(a.lat-b.lat,2)))}function ci(a,b){qb.call(this);this.point=a;this.type=b;this.K={}}z.lang.xa(ci,qb,"Vertex"); z.extend(ci.prototype,{initialize:function(a){this.map=a;var b="";this.point=fb(this.point,this.map.M.G3);var b=this.type?"BMap_vectex BMap_vectex_nodeT":"BMap_vectex BMap_vectex_node",c=this.PH=this.ca=document.createElement("div");c.className=b;a.$f().CP.appendChild(c);this.PA();return c},draw:function(){var a=this.map.ef(this.point);a&&(this.PH.style.left=a.x-5+"px",this.PH.style.top=a.y-5+"px")},va:function(a){if(a instanceof S||a instanceof N)this.point=this.K.point=this.map?fb(a,this.map.M.Oa): a,this.draw()},hk:u("point"),ma:function(){var a=this.map;return a?nb(this.point,a.M.Oa):this.point},PA:function(){function a(a,b){b.pixel=b.bb=a.bb;b.point=b.point=a.point;b.pointN=b.Af=a.Af;return b}function b(a){var b=a.clientX,c=a.clientY;a.changedTouches&&(b=a.changedTouches[0].clientX,c=a.changedTouches[0].clientY);return new T(b,c)}if(this.ca&&!this.ca.Zi){this.ca.Zi=q;var c=this.map,e=this,f=0,g=0,i=0,k={x:0,y:0};this.bt=function(a){pa(a);if(2!=a.button){e.Ll=q;var k=c.vc(e.point),o=b(a); f=o.x-k.x;g=o.y-k.y;i=lb();e.map.ba.Cv=e;z.V(document,"mousemove",e.vj);z.V(document,"mouseup",e.uj);z.V(document,"touchmove",e.vj);z.V(document,"touchend",e.uj);e.ca&&e.ca.setCapture&&e.ca.setCapture();e.ca.style.cursor=e.K.Ld;"touchstart"==a.type&&oa(a)}};this.vj=function(i){if(e.Ll){i=b(i);k=i=new T(i.x-f,i.y-g);e.lA=i;var n=e.map.cc(i),o=e.map.tg(i),n={bb:i,point:n,Af:o};e.Yl=e.Zl=0;if(20>=i.x||i.x>=e.map.width-20||50>=i.y||i.y>=e.map.height-10){if(20>=i.x?e.Yl=8:i.x>=e.map.width-20&&(e.Yl=-8), 50>=i.y?e.Zl=8:i.y>=e.map.height-10&&(e.Zl=-8),!e.Le)e.Le=setInterval(function(){c.Ng(e.Yl,e.Zl,{noAnimation:q});var a=c.cc(e.lA);e.va(a)},30)}else e.Le&&(clearInterval(e.Le),e.Le=s),e.va(o);e.Cl||(e.dispatchEvent(a(n,new R("ondragstart"))),e.Cl=q);e.dispatchEvent(a(n,new R("ondragging")))}};this.uj=function(){e.ca&&e.ca.releaseCapture&&e.ca.releaseCapture();e.Ll=t;e.map.ba.Cv=s;z.md(document,"mousemove",e.vj);z.md(document,"mouseup",e.uj);z.md(document,"touchmove",e.vj);z.md(document,"touchend", e.uj);f=g=0;e.Le&&(clearInterval(e.Le),e.Le=s);if(100<=lb()-i&&(2<k.x||2<k.y))e.Cl=t,e.dispatchEvent(a({bb:e.map.vc(e.ma()),point:e.ma(),Af:e.hk()},new R("ondragend"))),k.x=k.y=0;e.jm();e.ca&&(e.ca.style.cursor=e.K.qf?"pointer":"")};this.NW=function(b){pa(b);e.dispatchEvent(a({bb:e.map.vc(e.ma()),point:e.ma()},new R("ondelVertexMarker")))};z.V(this.ca,"mousedown",this.bt);z.V(this.ca,"touchstart",this.bt);z.V(this.ca,"contextmenu",this.NW)}}});z.extend(Dd.prototype,{UQ:function(a){return this.repeat?this.WQ(a):this.VQ(a)},WQ:function(a){var b=this.repeat,c=[],e,f,g;if(this.hJ){e=Math.floor(1/this.repeat)+1;for(f=0;f<e;f++)c.push(di(a,1-b*f,q))}else{g=a.lj[a.lj.length-1];e=Math.floor(g/b)+1;for(f=0;f<e;f++)c.push(di(a,g-f*b,t))}return c},VQ:function(a){return[di(a,this.pk,this.gJ)]},hide:function(){if(this.bd&&0<this.bd.length)for(var a=this.bd.length-1;0<=a;a--)this.bd[a].aa()},show:function(){if(this.bd&&0<this.bd.length)for(var a=this.bd.length- 1;0<=a;a--)this.bd[a].show()}}); function di(a,b,c){var e=a.ja;a.ZF&&(e=a.ZF);if(c){if(0>=b)return{point:e[0],index:1};if(1<=b)return{point:e[e.length-1],index:e.length-1};c=a.rT*b;b=ei(c,a.fm);a=(c-a.fm[b-1])/(a.fm[b]-a.fm[b-1])}else{c=b;b=a.lj[a.lj.length-1];if(0>=c)return{point:e[0],index:1};if(c>=b)return{point:e[e.length-1],index:e.length-1};b=ei(c,a.lj);a=(c-a.lj[b-1])/(a.lj[b]-a.lj[b-1])}c=e[b];e=U.Sa(e[b-1]);c=U.Sa(c);return{point:U.Zb(new S(e.lng+(c.lng-e.lng)*a,e.lat+(c.lat-e.lat)*a)),index:b}} z.oc.indexOf=function(a,b,c){var e=a.length,c=c|0;for(0>c&&(c=Math.max(0,e+c));c<e;c++)if(c in a&&a[c]===b)return c;return-1};function ei(a,b){var c=fi(b.concat(a));return z.oc.indexOf(c,a)}function fi(a){if(2>a.length)return a;for(var b=Math.floor(a.length/2),c=a.slice(0,b),a=a.slice(b),c=fi(c),a=fi(a),b=[];0<c.length&&0<a.length;)c[0]>a[0]?b.push(a.shift()):b.push(c.shift());return b.concat(c).concat(a)};z.extend(zd.prototype,{initialize:function(a){a&&this.Qv&&a.addEventListener("onmousemove",this.Qv);a=qb.prototype.initialize.call(this,a);this.K.Ae===q&&(this.li(),this.Ak());return a},Uj:function(){this.ca=(this.jo=gi.ut(this.map)).Wo()},hd:u("ca"),ha:function(){function a(a,b){var c=a.srcElement||a.target,i=Pb(),k=a.pageX?a.pageX:a.clientX+i[1],i=a.pageY?a.pageY:a.clientY+i[0];if(a&&b&&k&&i&&c){var c=z.lang.Uc(c.da).map,m=z.U.ma(c.$a);b.bb=new T(k-m.left,i-m.top);b.point=c.cc(b.bb);b.Af=c.tg(b.bb); b.pixel=b.bb;b.point=b.point;b.pointN=b.Af}return b}var b=this.ca,c=this;"canvas"!==gi.ut(this.map).Kp()&&!M()&&(c.K.qf&&(b.style.cursor="pointer",z.V(b,"click",function(b){c.OI&&c.OI.Vb(c.map.Hv())&&c.dispatchEvent(a(b,na(new R("onclick"),b)))}),z.V(b,"dblclick",function(b){c.dispatchEvent(a(b,na(new R("ondblclick"),b)))}),(!z.ga.Xe||4>z.ga.Xe)&&z.V(this.ca,"contextmenu",function(b){c.dispatchEvent(a(b,na(new R("onrightclick"),b)))})),z.V(b,"mousedown",function(b){c.dispatchEvent(a(b,na(new R("onmousedown"), b)));c.OI=c.map.Hv()}),z.V(b,"mouseup",function(b){c.dispatchEvent(a(b,na(new R("onmouseup"),b)))}),z.V(this.ca,"mouseup",function(b){c.dispatchEvent(a(b,na(new R("onmouseup"),b)));z.ga.Xe>=4&&(b.button===2&&c.K.qf)&&c.dispatchEvent(a(b,na(new R("onrightclick"),b)))}));b=s;this.Zi||(this.Zi=q,this.Qv=function(a){if(c.map&&!c.map.ba.Cv){var b=c.RS(a.point),g=parseFloat(b.Ia),i;if(g<c.K.AN){i=c.Ya.my?new R("onmousemove"):new R("onmouseover");c.Ya.$M=t;c.Ya.my=q}else if(!c.Ya.$M&&c.Ya.my){i=new R("onmouseout"); c.Ya.my=t;c.Ya.$M=q}if(i){if(!(c instanceof Sd)&&i.type==="onmousemove"&&c.Ya.my===q&&(g===0||g>c.K.AN)){i.pixel=i.bb=a.bb;i.point=i.point=a.point;i.pointN=i.Af=a.Af}else{i.point=i.point=this.XN(b.bb);i.pixel=i.bb=this.vc(i.point);i.pointN=i.Af=this.TT(b.bb)}c.dispatchEvent(i)}}},this.map.addEventListener("onmousemove",this.Qv),this.addEventListener("mouseover",ba()),this.addEventListener("mouseout",ba()))},draw:function(a){if(this.ca&&this.jo){var b;if(this.K.OX){this.PD=[];b=s;for(var c=0;c<this.ja.length- 1;c++){var e=this.XV(this.ja[c],this.ja[c+1],b);b=e[e.length-1]&&e[e.length-1].Ch;this.PD=this.PD.concat(e)}b=this.eI(this.PD)}else if(this.K.XE&&0<this.ja.length){this.Yt=[];b=s;for(c=0;c<this.ja.length-1;c++)this.Yt.push({point:this.ja[c],Ch:b||U.Sa(this.ja[c])}),e=b||U.Sa(this.ja[c]),b=U.Sa(this.ja[c+1]),15437726<bi(b,e)&&(b.lng=b.lng<e.lng?b.lng+Ab:b.lng-Ab),this.Yt.push({point:this.ja[c+1],Ch:b}),b=this.Yt[this.Yt.length-1].Ch;b=this.eI(this.Yt)}else b=this.Iv(this.ja);"canvas"===this.jo.Pb&& this.rw?(this.rw(),this.jo.Ud(this.ca,b,this.K)):this.jo.Ud(this.ca,b);this instanceof Sd&&this.K.wi&&this.VR(a)}},ob:function(){this.map&&(this.initialize(this.map),this.ca.style.WebkitUserSelect="none",this.draw())},Iv:function(a){var b=this.map,c=[],e=[],f=b.Nd(),g=this.Nd();if(!f.Mt(g)||0===a.length||!this.ca||!this.Oc())return this.ZF=e,[c];this.K.Ae||(f=this.Nm(b.la()),this.nf[f]?a=this.nf[f]:(a=hi(a,this.Qk(b.la())),a=this.nf[f]=a));f=this.K.t1;c.push(b.ef(a[0],s,f));e.push(a[0]);for(var i= g=1,k=a.length;g<k;g++){var m=b.ef(a[g],s,f);m.Vb(c[i-1])||(c.push(m),e.push(a[g]),i++)}this.ZF=e;return[c]},J2:function(a){if(a&&0<a.length){for(var b=[],c=s,e=0;e<a.length-1;e++){b.push({point:a[e],Ch:c||U.Sa(a[e])});var f=c||U.Sa(a[e]),c=U.Sa(a[e+1]);30037726<bi(c,f)&&(c.lng=c.lng<f.lng?c.lng+Ab:c.lng-Ab);b.push({point:a[e+1],Ch:c});c=b[b.length-1].Ch}return b}},Nm:function(a){return this.K.Nm?this.K.Nm(a):6>a?0:10>a?1:15>a?2:3},Qk:function(a){return this.K.Qk?this.K.Qk(a):zd.mF[this.Nm(a)]},fs:function(a){this.nf.length= 0;a=zd.Hx(a);this.Po=a.slice(0,a.length-1);this.ja=a.slice(0);this.Nh();this.draw();this.dispatchEvent(new R("onlineupdate"))},XV:function(a,b,c){var e=[];e.push({point:a,Ch:c||U.Sa(a)});var f=c||U.Sa(a);if(a.Vb(b)||25E4>U.Nk(a,b)){var c=U.Sa(b),g=bi(c,f);30037726<g&&(c.lng=c.lng<f.lng?c.lng+Ab:c.lng-Ab);c&&e.pop();e.push({point:b,Ch:c});return e}for(var g=U.Od(ac(a.lng),ac(a.lat),ac(b.lng),ac(b.lat)),c=Math.round(g/15E4),i=this.EK(a,b),k=0;k<c;k++){var m=this.FK(a,b,k/c,i),n=U.Sa(m),g=bi(n,f);30037726< g&&(n.lng=n.lng<f.lng?n.lng+Ab:n.lng-Ab);e.push({point:m,Ch:n});f=n}c=U.Sa(b);g=bi(c,f);30037726<g&&(c.lng=c.lng<f.lng?c.lng+Ab:c.lng-Ab);e.push({point:b,Ch:c});return e},Ud:function(a){this.fs(a);this.K.Ae===q&&(this.li(),this.Ak())},zn:function(a,b){b&&this.ja[a]&&(this.nf.length=0,this.ja[a]=new S(b.lng,b.lat),this.Nh(),this.K.Ae===q&&(this.li(),this.Ak()),this.draw(),this.dispatchEvent(new R("onlineupdate")))},setStrokeColor:function(a){this.K&&(this.K.strokeColor=a);this.hm("strokecolor",a)}, vq:function(a){0<a&&(this.K.tc=a,this.hm("strokeweight",a),"dashed"===this.kM()&&(this.map&&"svg"===gi.ut(this.map).Kp())&&this.hm("strokestyle","dashed"))},tq:function(a){a===l||(1<a||0>a)||(this.K.Ad=a,this.map&&this.hm("strokeopacity",a))},su:function(a){1<a||0>a||(this.K.Dg=a,this.hm("fillopacity",a))},uq:function(a){"solid"!==a&&"dashed"!==a||(this.K.strokeStyle=a,this.hm("strokestyle",a))},setFillColor:function(a){this.K.fillColor=a||"";this.hm("fillcolor",a)},hm:function(a,b){this.jo&&(this.jo.setAttribute(this.ca, a,b||"",this.lM()),this.dispatchEvent(new R("onlineupdate")))},Ak:function(){var a=this;if(!a.uc.length)for(var b=this.tM(),c=function(b){a.ew(b)},e=ba(),f=function(b){a.sB(b)},g=function(b){a.wQ(b)},i=0,k=b.length;i<k;i++){var m=b[i],n=new ci(m.zb,m.sa);n.addEventListener("ondragging",c);n.addEventListener("ondragstart",e);n.addEventListener("ondragend",f);n.addEventListener("ondelVertexMarker",g);n.index=i;n.sa=m.sa;this.uc.push(n);this.map&&this.map.Ra(n)}},li:function(){for(var a;a=this.uc.pop();)this.map.Lb(a); this.uc.length=0},tM:function(){for(var a=[],b=0,c=this.ja.length;b<c;b++){var e=this.ja[b];a.push({zb:e,sa:0});if(b<c-1){var f=this.ja[b+1],e=new S((e.lng+f.lng)/2,(e.lat+f.lat)/2);a.push({zb:e,sa:1})}}return this.nc=a},S2:ba(),sB:function(a){this.Ya.tj&&(this.map.Lb(this.Ya.tj),delete this.Ya.tj);this.Ya.Ji&&(this.map.Lb(this.Ya.Ji),delete this.Ya.Ji);this.Ya.Fi&&(this.map.Lb(this.Ya.Fi),delete this.Ya.Fi);var b=a.Af,a=a.currentTarget.index,c;if(0!==a%2){this.Bl(a);this.Vq(a,b,0);var e=fb(this.nc[a- 1].zb,this.map.M.Oa);c=fb(this.nc[a+1].zb,this.map.M.Oa);e=this.mt(e,b);c=this.mt(b,c);this.Vq(a,e,1);this.Vq(a+2,c,1);a=Math.ceil(a/2);c=this.ja.slice();a=c.splice(a,this.ja.length-a);c[c.length]=b;c=c.concat(a)}else this.nc[a].zb=b,0<=a-2&&(e=fb(this.nc[a-2].zb,this.map.M.Oa),e=this.mt(e,b),this.uc[a-1].show(),this.uc[a-1].va(e)),a+2<this.nc.length&&(c=fb(this.nc[a+2].zb,this.map.M.Oa),c=this.mt(b,c),this.uc[a+1].show(),this.uc[a+1].va(c)),this instanceof Rd&&this.nc.length-1===a&&(this.Bl(0),this.Vq(0, b,0),this.Bl(1),this.Vq(1,this.mt(fb(this.nc[0].zb,this.map.M.Oa),fb(this.nc[1].zb,this.map.M.Oa)),1),this.uc[0].ca.style.zIndex="-10000000"),a/=2,this.ja.splice(a,1,b),this instanceof Rd&&this.ja.length-1===a&&this.ja.splice(0,1,b),c=this.ja;b=0;for(a=this.uc.length;b<a;b++)this.uc[b].index=b;this.ja=c;this.fs(c);this.K.Ae===q&&(this.li(),this.Ak())},wQ:function(a){if(0===a.target.type||0===a.target.sa){var b=[];if(6>this.nc.length)alert("\u70b9\u4f4d\u5927\u4e8e3,\u624d\u80fd\u5220\u9664");else{0== a.target.index||a.target.index==this.nc.length-1?this instanceof Rd?(this.Bl(this.nc.length-1),this.Bl(0)):this.Bl(a.target.index):this.Bl(a.target.index);this.li();for(a=0;a<this.nc.length;a++)0===this.nc[a].sa&&b.push(this.nc[a].zb);this.ja=b;this.ja[0].lng==this.ja[this.ja.length-1].lng&&this.ja[0].lat==this.ja[this.ja.length-1].lat&&this.ja.splice(this.ja.length-1,1);this.Ud(this.ja)}}else alert("\u53ea\u80fd\u5220\u9664\u5b9e\u70b9")},Vq:function(a,b,c){var e=this;this.nc.splice(a,0,{zb:b,sa:c}); b=new ci(b,c);b.addEventListener("ondragging",function(a){e.ew(a)});b.addEventListener("ondragstart",ba());b.addEventListener("ondragend",function(a){e.sB(a)});b.index=a;b.sa=c;this.uc.splice(a,0,b);this.map.Ra(b)},Bl:function(a){this.map.Lb(this.uc[a]);this.nc.splice(a,1);this.uc.splice(a,1)},mt:function(a,b){return new N((a.lng+b.lng)/2,(a.lat+b.lat)/2)},RS:function(a){var b,c,e,f,g,i,k=[],m=this.map.ef(a),k=this.Iv(this.ja)[0],n=k.length;if(1<n){for(f=1;f<n;f++){var o=k[f-1],p=k[f];if(o&&p){o.x!== p.x?(g=(p.y-o.y)/(p.x-o.x),g=Math.abs(g*m.x+(p.y-g*p.x)-m.y)/Math.sqrt(g*g+1)):g=Math.abs(m.x-p.x);var v=Math.pow(p.y-o.y,2)+Math.pow(p.x-o.x,2),p=Math.pow(p.y-m.y,2)+Math.pow(p.x-m.x,2),o=Math.pow(o.y-m.y,2)+Math.pow(o.x-m.x,2),w=Math.pow(g,2);p-w+o-w>v&&(g=Math.sqrt(Math.min(p,o)));if(b==s||b>g)c=Math.sqrt(o-w)/Math.sqrt(v),e=Math.sqrt(p-w)/Math.sqrt(v),b=g,i=f;b=Math.min(b,g)}}if(!(this instanceof Sd)){g=m=0;v=this.ja;for(f=0;f<n;f++)m=f===n-1?0:m+1,v[f].lat!==v[m].lat&&((a.lat>=v[f].lat&&a.lat< v[m].lat||a.lat>=v[m].lat&&a.lat<v[f].lat)&&a.lng<(v[m].lng-v[f].lng)*(a.lat-v[f].lat)/(v[m].lat-v[f].lat)+v[f].lng)&&g++;b=Math.min(b,0<g%2?0:b)}1<c&&(c=1);1<e&&(c=0);a=k[i-1].y-k[i].y;f=k[i-1].x-(k[i-1].x-k[i].x)*c;g=k[i-1].y-a*c}return{bb:new T(f,g),Ia:b}},show:function(){qb.prototype.show.call(this);this.draw();this.K.Ae===q&&this.Ak()},aa:function(){qb.prototype.aa.call(this);this.K.Ae===q&&this.li()},remove:function(){xd.prototype.remove.call(this);this.K.Ae===q&&this.li()}}); function ii(a,b){var c={top:0,bottom:0,right:0,left:0,all:0},e=a.x,f=a.y;f<b.dg?(c.top=8,c.all+=c.top):f>b.Di&&(c.bottom=4,c.all+=c.bottom);e>b.Ci?(c.right=2,c.all+=c.right):e<b.cg&&(c.left=1,c.all+=c.left);return c} function hi(a,b){if(1>=a.length)return a;var c=a,e=b!==l?b*b:1,f=c.length,g=new ("undefined"!==typeof Uint8Array?Uint8Array:Array)(f),i=0,k=f-1,m=[],n=[],o,p,v,w;for(g[i]=g[k]=1;k;){p=0;for(o=i+1;o<k;o++){v=c[o];var A=c[i],B=c[k],D=A.lng,A=A.lat,F=B.lng-D,H=B.lat-A;if(0!==F||0!==H){var G=((v.lng-D)*F+(v.lat-A)*H)/(F*F+H*H);1<G?(D=B.lng,A=B.lat):0<G&&(D+=F*G,A+=H*G)}F=v.lng-D;H=v.lat-A;v=F*F+H*H;v>p&&(w=o,p=v)}p>e&&(g[w]=1,m.push(i,w,w,k));k=m.pop();i=m.pop()}for(o=0;o<f;o++)g[o]&&n.push(c[o]);return n} V(bh,{show:bh.show,hide:bh.aa,remove:bh.remove,setPath:bh.Ud,setPositionAt:bh.zn,setStrokeColor:bh.setStrokeColor,setStrokeWeight:bh.vq,setStrokeOpacity:bh.tq,setFillOpacity:bh.su,setStrokeStyle:bh.uq,setFillColor:bh.setFillColor,getDom:bh.hd});z.extend(Sd.prototype,{initialize:function(a){zd.prototype.initialize.call(this,a);this.wJ=[0];this.em=[0];this.fm=[0];for(var a=1,b=this.ja,c=b.length;a<c;a++){this.wJ[a]=U.Nk(b[a],b[a-1]);var e=U.Sa(b[a-1]),f=U.Sa(b[a]);this.em[a]=90-180*Math.atan2(f.lat-e.lat,f.lng-e.lng)/Math.PI;this.fm[a]=this.fm[a-1]+this.wJ[a]}this.rT=this.fm[c-1];this.rw();this.qw={};this.vJ={};return this.ca},rw:function(){this.setFillColor("");this.setStrokeColor(this.K.strokeColor);this.vq(this.K.tc);this.uq(this.K.strokeStyle); this.tq(this.K.Ad)},eI:function(a){if(!a)return[];for(var b=this.map,c=[],e=0;e<a.length;e++)c.push(b.OZ(a[e].Ch));return[c].concat(this.BQ(c,b.la(),q))},BQ:function(a,b,c){for(var e=this.map,b=b||e.la(),f=[],g=[],b=c?e.M1(b):Ab,c=0;c<a.length;c++)f.push(new T(a[c].x-b,a[c].y)),g.push(new T(a[c].x+b,a[c].y));return[f,g]},Iv:function(a){var b=this.map,c=[],e=b.Nd(),f=this.Nd();if(!e.Mt(f)||0==a.length||!this.ca||!this.Oc())return[c];!(M()&&5E3<a.length)&&!this.K.Ae&&(e=this.Nm(b.la()),this.nf[e]?a= this.nf[e]:(f=hi(a,this.Qk(b.la())),a=this.nf[e]=f));c.push(b.ef(a[0]));for(var g=e=1,f=a.length;e<f;e++){var i=b.ef(a[e]);i.Vb(c[g-1])||(c.push(i),g++)}a=[];e=b.offsetX;f=b.offsetY;g=b.M.vx;b={cg:-e-g,dg:-f-g,Ci:-e+g+b.width,Di:-f+g+b.height};e=0;for(f=c.length-1;e<f;e++){var k=c[e],m=c[e+1],g=b,n=i=t,o=t,k=new T(k.x,k.y),m=new T(m.x,m.y),p=ii(k,g),v=ii(m,g),w=l,A=l,B=l,D=g.cg,F=g.dg,H=g.Ci,G=g.Di;do 0===p.all&&0===v.all?o=i=q:0!==(p.all&v.all)?o=q:(w=0!==p.all?p:v,w.top?(A=k.x+(m.x-k.x)*(F-k.y)/ (m.y-k.y),B=F):w.bottom?(A=k.x+(m.x-k.x)*(G-k.y)/(m.y-k.y),B=G):w.right?(B=k.y+(m.y-k.y)*(H-k.x)/(m.x-k.x),A=H):w.left&&(B=k.y+(m.y-k.y)*(D-k.x)/(m.x-k.x),A=D),n=q,w.all===p.all)?(k.x=Math.round(A),k.y=Math.round(B),p=ii(k,g)):(m.x=Math.round(A),m.y=Math.round(B),v=ii(m,g));while(!o);g=i?{cO:new T(k.x,k.y),dO:new T(m.x,m.y),clip:n?q:t}:l;g&&a.push(g)}c=[[]];e=0;for(f=a.length;e<f;e++)a[e].clip?(c[c.length-1].push(a[e].cO),c[c.length-1].push(a[e].dO),a[e+1]&&a[e+1].clip&&c.push([])):(c[c.length-1].push(a[e].cO), e==a.length-1&&c[c.length-1].push(a[e].dO));return c},hide:function(){zd.prototype.aa.call(this);if(this.K.wi&&0<this.K.wi.length)for(var a=0,b=this.K.wi.length;a<b;a++)this.K.wi[a].hide()},show:function(){zd.prototype.show.call(this);if(this.K.wi&&0<this.K.wi.length)for(var a=0,b=this.K.wi.length;a<b;a++)this.K.wi[a].show()},VR:function(a){var b=this.Lx(),c=b.la(),e=b.Nd(),f=this.K.wi,g=zd.prototype.Iv.call(this,this.ja),i=!this.K.Ae;if(i&&this.qw[c]&&1<this.qw[c].length)this.lj=this.qw[c],this.em= this.vJ[c];else{for(var k=[0],m=[0],n=1,g=g[0],o=g.length;n<o;n++)k[n]=k[n-1]+Qb(g[n],g[n-1]),m[n]=90+180*Math.atan2(g[n].y-g[n-1].y,g[n].x-g[n-1].x)/Math.PI;this.lj=this.qw[c]=k;this.em=this.vJ[c]=m}for(n=0;n<f.length;n++){var k=f[n],m=k.O0,p;i&&k.jw[c]&&0<k.jw[c].length?g=k.jw[c]:(g=k.UQ(this),1<g.length&&(k.jw[c]=g));if(1===g.length)e.Is(g[0].point)&&(k.bd[0]&&(b.Lb(k.bd[0]),k.bd[0].remove()),k.FL||(7===m.Pb||5===m.Pb?m.setRotation(-180+this.em[g[0].index]):m.setRotation(this.em[g[0].index])), k.bd[0]=new Fd(g[0].point,{icon:m}),b.Ra(k.bd[0]));else if(1<g.length){var v=[],w,A={};if(!i||a&&("onzoomend"===a.type||"onmoveend"===a.type)){for(var B in k.bd)b.Lb(k.bd[B]),k.bd[B].remove();k.bd=[]}else z.oc.Rb(k.bd,function(a){if(e.Is(a.ma())){w=""+a.ma().lat+(""+a.ma().lng);A[w]=q;v.push(a)}else{b.Lb(a);a.remove()}}),k.bd=v;for(B=0;B<g.length;B++){p=g[B].index;var o=g[B].point,D=""+o.lat+(""+o.lng);e.Is(o)&&!A[D]&&(k.FL||(7===m.Pb||5===m.Pb?m.setRotation(-180+this.em[p]):m.setRotation(this.em[p])), o=new Fd(o,{icon:m}),k.bd.push(o),b.Ra(o))}}}},ew:function(a){var b=a.currentTarget,c=a.Af,e=b.index,f=this.nc,g,i=a=s;if(0==e){var k=fb(f[e+2].zb,this.map.M.Oa);g=[c,k];a=new N((k.lng+c.lng)/2,(k.lat+c.lat)/2);this.uc[e+1]&&this.uc[e+1].aa()}else if(e==f.length-1){var m=fb(f[e-2].zb,this.map.M.Oa);g=[m,c];a=new N((m.lng+c.lng)/2,(m.lat+c.lat)/2);this.uc[e-1]&&this.uc[e-1].aa()}else m=fb(f[e-1].zb,this.map.M.Oa),k=fb(f[e+1].zb,this.map.M.Oa),g=[m,c,k],b.sa||(m=fb(f[e-2].zb,this.map.M.Oa),k=fb(f[e+ 2].zb,this.map.M.Oa),g=[m,c,k],a=new N((m.lng+c.lng)/2,(m.lat+c.lat)/2),i=new N((k.lng+c.lng)/2,(k.lat+c.lat)/2),this.uc[e-1]&&this.uc[e-1].aa(),this.uc[e+1]&&this.uc[e+1].aa());this.Ya.tj?(this.Ya.tj.Ud(g),this.Ya.tj.show()):(b=new Sd(g,{strokeStyle:"dashed",strokeColor:this.K.strokeColor,tc:this.K.tc,Ad:this.K.Ad,XE:this.K.XE}),this.map.Ra(b),b.aa(),this.Ya.tj=b);!this.Ya.Ji&&a?(this.Ya.Ji=new ci(a,1),this.map.Ra(this.Ya.Ji)):a&&this.Ya.Ji.va(a);!this.Ya.Fi&&i?(this.Ya.Fi=new ci(i,1),this.map.Ra(this.Ya.Fi)): i&&this.Ya.Fi.va(i)}});z.oc.remove=function(a,b){for(var c=a.length;c--;)a[c]===b&&a.splice(c,1);return a};z.extend(Rd.prototype,{initialize:function(a){zd.prototype.initialize.call(this,a);this.setStrokeColor(this.K.strokeColor);this.vq(this.K.tc);this.uq(this.K.strokeStyle);this.setFillColor(this.K.fillColor);this.tq(this.K.Ad);this.su(this.K.Dg);return this.ca},zn:function(a,b){this.Po[a]&&(this.nf.length=0,this.Po[a]=new S(b.lng,b.lat),this.ja[a]=new S(b.lng,b.lat),0==a&&!this.ja[0].Vb(this.ja[this.ja.length-1])&&(this.ja[this.ja.length-1]=new S(b.lng,b.lat)),this.Nh(),this.K.Ae==q&&(this.li(),this.Ak()), this.draw(),this.dispatchEvent(new R("onlineupdate")))},rw:function(){this.setStrokeColor(this.K.strokeColor);this.vq(this.K.tc);this.uq(this.K.strokeStyle);this.setFillColor(this.K.fillColor);this.tq(this.K.Ad);this.su(this.K.Dg)},containPoint:function(a){var b=this.ja,c=t;if(a instanceof S||a instanceof N){if(this.ov.Is(a)){for(var e=a.lat,a=a.lng,f=0,g=b.length-1;f<b.length;g=f++){var i=b[f].lat,k=b[f].lng,m=b[g].lat,g=b[g].lng;k>a!=g>a&&e<(m-i)*(a-k)/(g-k)+i&&(c=!c)}return c}return t}},ew:function(a){var b= a.currentTarget,c=a.point,e=b.index,f=this.nc,g,i=a=s;if(0==e){var k=nb(f[f.length-2].zb,this.map.M.Oa),m=nb(f[e+2].zb,this.map.M.Oa);g=[k,c,m];b.sa||(a=new S((k.lng+c.lng)/2,(k.lat+c.lat)/2),i=new S((m.lng+c.lng)/2,(m.lat+c.lat)/2))}else e==f.length-1?(m=nb(f[2].zb,this.map.M.Oa),k=nb(f[e-2].zb,this.map.M.Oa),g=[k,c,m],b.sa||(a=new S((k.lng+c.lng)/2,(k.lat+c.lat)/2),i=new S((m.lng+c.lng)/2,(m.lat+c.lat)/2))):(k=nb(f[e-1].zb,this.map.M.Oa),m=nb(f[e+1].zb,this.map.M.Oa),g=[k,c,m],b.sa||(k=nb(f[e-2].zb, this.map.M.Oa),m=nb(f[e+2].zb,this.map.M.Oa),g=[k,c,m],a=new S((k.lng+c.lng)/2,(k.lat+c.lat)/2),i=new S((m.lng+c.lng)/2,(m.lat+c.lat)/2),this.uc[e-1]&&this.uc[e-1].aa(),this.uc[e+1]&&this.uc[e+1].aa()));this.Ya.tj?this.Ya.tj.Ud(g):(b=new Sd(g,{strokeStyle:"dashed",strokeColor:this.K.strokeColor,tc:this.K.tc,Ad:this.K.Ad}),this.map.Ra(b),this.Ya.tj=b);!this.Ya.Ji&&a?(this.Ya.Ji=new ci(a,1),this.map.Ra(this.Ya.Ji)):a&&this.Ya.Ji.va(a);!this.Ya.Fi&&i?(this.Ya.Fi=new ci(i,1),this.map.Ra(this.Ya.Fi)): i&&this.Ya.Fi.va(i)}});V(dh,{setPositionAt:dh.zn});z.extend(Td.prototype,{initialize:function(a){Rd.prototype.initialize.call(this,a);this.ja=this.Kv(this.point,this.Fa);this.Nh();return this.ca},Bf:function(a,b){a&&(this.nf.length=0,b||(this.nc=s),this.point=a,this.ja=this.Kv(a,this.Fa),this.Nh(),this.draw(),this.dispatchEvent(new R("onlineupdate")))},Cf:function(a,b){isNaN(a)||(this.nf.length=0,b||(this.nc=s),this.Fa=Math.abs(a),this.ja=this.Kv(this.point,this.Fa),this.Nh(),this.draw(),this.dispatchEvent(new R("onlineupdate")))},Qk:function(a){return this.K.Qk? this.K.Qk(a):Td.mF[this.Nm(a)]},ew:function(a){var b,a=a.currentTarget,c=this.nc;b=c[0].zb;c=c[c.length-1].zb;0==a.index?(b=a.ma(),a=c):a=a.ma();this.Cf(U.Nk(fb(b,this.map.M.Oa),fb(a,this.map.M.Oa)),q);this.Bf(b,q)},sB:function(a){var a=a.currentTarget,b=a.index;this.nc[0]={zb:this.point,sa:0};1==b&&(this.nc[1]={zb:a.point,sa:0});this.li();this.Ak()},tM:function(){if(!this.nc){var a=[];a.push({zb:this.point,sa:0});a.push({zb:this.ja[Math.floor(3*this.ja.length/4)],sa:0});this.nc=a}return this.nc}}); V(ch,{setCenter:ch.Bf,setRadius:ch.Cf});var gi={ut:function(a){gi["_"+a.da]||(gi["_"+a.da]={});switch(a.M.tL){case 1:return gi.mM(a);case 2:return gi.uM(a);case 3:return gi.ZD(a)}if(M()&&gi.VM()&&4!==a.M.tL)return gi.ZD(a);if(gi.yZ())return gi.mM(a);if(gi.zZ())return gi.uM(a);if(gi.VM())return gi.ZD(a)},mM:function(a){gi["_"+a.da].PJ||(gi["_"+a.da].PJ=new C.qQ(a));return gi["_"+a.da].PJ},uM:function(a){gi["_"+a.da].cK||(gi["_"+a.da].cK=new C.tQ(a));return gi["_"+a.da].cK},ZD:function(a){gi["_"+a.da].CH||(gi["_"+a.da].CH=new C.QP(a));return gi["_"+ a.da].CH},zZ:function(){if(Sb(gi.ZO))return gi.ZO;var a=Yb();return gi.ZO=a},yZ:function(){Sb(gi.YO)||(gi.YO=Zb());return gi.YO},VM:function(){Sb(gi.XO)||(gi.XO=$b());return gi.XO}};C.Nq=gi; 
