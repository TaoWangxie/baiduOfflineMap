z.object.extend(qd.prototype,{za:function(a,b){if(this.R)return t;this.P=a;this.Vl=b||s;this.Ha();var c=this,e=a.M.Ac;b&&b.K.qf&&(e="pointer");this.R.style.cursor=e;this.Hd&&(this.Hd.style.cursor=e);z.V(document,"mousedown",function(){c.R&&c.aa()});z.V(this.R,"click",function(a){c.aa();oa(a)});e=this.m.$a;e||(e=a.$a);this.Vl?this.Vl.addEventListener("rightclick",function(a){c.R&&c.IJ(a)}):a.addEventListener("rightclickex",function(a){c.R&&(!a.yb&&!a.Fb)&&c.IJ(a)});for(var e=0,f=this.Ea.length;e<f;e++)"menuitem"== this.Ea[e].Pb&&this.Ea[e].za(a,this),"divider"==this.Ea[e].Pb&&(this.Ke[this.Ea[e].$j].U=Mb(this.R,"<div class='BMap_cmDivider'></div>"));this.ws()},ob:function(){this.P&&(this.za(this.P,this.Vl),this.Vh&&(this.Vh=t,this.show()))},remove:function(){this.R&&(this.R.parentNode.removeChild(this.R),this.R=s);this.Hd&&(this.Hd.parentNode.removeChild(this.Hd),this.Hd=s);for(var a=0,b=this.Ea.length;a<b;a++)"menuitem"==this.Ea[a].Pb&&(this.Ea[a].R=s);this.P=this.Vl=s},Ha:function(){this.R=Mb(this.P.$a,"<div unselectable='on'></div>"); this.R.className="BMap_contextMenu";var a=this.R.style;a.font="12px "+L.fontFamily;9>z.ga.oa?this.Hd=Mb(this.P.$a,"<div class='BMap_cmShadow'></div>"):a.SV=a.dQ=a.WebkitBoxShadow="1px 2px 6px #666";return this.R},As:function(a){if(a&&!("menuitem"!=a.Pb||""==a.mh||0>=a.nj)){for(var b=0,c=this.Ea.length;b<c;b++)if(this.Ea[b]===a)return;this.Ea.push(a);this.Sf.push(a);this.P&&(a.za(this.P,this),z.U.jb(a.hd(),"BMap_cmLstItem"),1<this.Ea.length?"menuitem"==this.Ea[this.Ea.length-2].Pb&&z.U.rc(this.Ea[this.Ea.length- 2].hd(),"BMap_cmLstItem"):"menuitem"==this.Ea[0].Pb&&z.U.jb(this.Ea[0].hd(),"BMap_cmFstItem"),this.ws())}},removeItem:function(a){if(a&&"menuitem"==a.Pb){for(var b=0,c=this.Ea.length;b<c;b++)this.Ea[b]===a&&(this.Ea[b].remove(),this.Ea.splice(b,1),c--);b=0;for(c=this.Sf.length;b<c;b++)this.Sf[b]===a&&(this.Sf[b].remove(),this.Sf.splice(b,1),c--);this.R&&(0<this.Ea.length&&"menuitem"==this.Ea[this.Ea.length-1].Pb&&z.U.jb(this.Ea[this.Ea.length-1].hd(),"BMap_cmLstItem"),this.ws())}},nC:function(){this.Ea.push({Pb:"divider", $j:this.Ke.length});this.Ke.push({U:s});this.R&&(this.Ke[this.Ke.length-1].U=Mb(this.R,"<div class='BMap_cmDivider'></div>"),this.ws())},zF:function(a){if(this.Ke[a]){this.Ke[a].U&&this.Ke[a].U.parentNode&&this.Ke[a].U.parentNode.removeChild(this.Ke[a].U);for(var b=0,c=this.Ea.length;b<c;b++)this.Ea[b]&&("divider"==this.Ea[b].Pb&&this.Ea[b].$j==a)&&(this.Ea.splice(b,1),c--),this.Ea[b]&&("divider"==this.Ea[b].Pb&&this.Ea[b].$j>a)&&this.Ea[b].$j--;this.Ke.splice(a,1);this.ws()}},va:function(a,b){this.R.style.left= a+"px";this.R.style.top=b+"px";this.Hd&&(this.Hd.style.left=a+1+"px",this.Hd.style.top=b+2+"px")},show:function(){if(this.Vh!=q&&0!=this.Sf.length){this.Vh=q;this.R&&(this.R.style.visibility="visible");this.Hd&&(this.Hd.style.visibility="visible");var a=new R("onopen");a.point=this.ox;a.pixel=this.Ns;this.dispatchEvent(a)}},aa:function(){if(this.Vh!=t){this.Vh=t;this.R&&(this.R.style.visibility="hidden");this.Hd&&(this.Hd.style.visibility="hidden");var a=new R("onclose");a.point=this.ox;a.pixel=this.Ns; this.dispatchEvent(a)}},e0:function(a){if(a&&(this.m.cursor=a,this.R&&(this.R.style.cursor=this.m.cursor),this.Hd))this.Hd.style.cursor=this.m.cursor},ws:function(){this.R&&this.Hd&&(this.Hd.style.width=this.R.offsetWidth+"px",this.Hd.style.height=this.R.offsetHeight+"px")},IJ:function(a){if(0!=this.Sf.length){this.Ns=a.bb;this.ox=this.P.tg(this.Ns);var b=this.hd().offsetHeight,c=this.hd().offsetWidth,e=a.bb.x,f=a.bb.y;a.bb.x+c>this.P.width&&(e=a.bb.x-c);a.bb.y+b>this.P.height&&(f=a.bb.y-b);this.va(e, f);this.show()}}});V(lh,{addItem:lh.As,removeItem:lh.removeItem,addSeparator:lh.nC,removeSeparator:lh.zF});z.object.extend(td.prototype,{za:function(a,b){if(this.R)return t;this.P=a;this.Qh=b;b.hd()&&(this.Ha(),this.ha(),this.Th||(this.Th=q,this.disable()));return q},remove:function(){this.R&&(this.R.parentNode.removeChild(this.R),this.R=s);this.P=this.Qh=s},ob:function(){this.Qh&&this.P&&this.za(this.P,this.Qh)},Ha:function(){var a=this.m.Vm?"<div"+(this.m.id?" id='"+this.m.id+"'":"")+" unselectable='on'><div style='width: 17px;height: 17px;margin-right: 3px;display: inline-block;zoom: 1;*display: inline;vertical-align: middle;background: url("+ this.m.Vm+") no-repeat;'></div><span style='vertical-align: middle;'>"+this.mh+"</span></div>":"<div"+(this.m.id?" id='"+this.m.id+"'":"")+" unselectable='on'><span>"+this.mh+"</span></div>";this.R=Mb(this.Qh.hd(),a);this.m.Vm?(this.Tv=this.R.firstChild,this.ns=this.R.lastChild):this.ns=this.R;a=this.R.style;a.padding="2px 6px";a.margin="0 2px";a.fontSize="14px";a.MozUserSelect="none";a.lineHeight="17px";a.width=this.m.width+"px";this.Th?(a.color="#000",a.cursor="pointer"):(a.color="#aaa",a.cursor= this.P.M.Ac);return this.R},ha:function(){var a=this;z.V(this.R,"click",function(b){a.Th?a.Sz&&a.Sz.call&&a.Sz.call(a,a.Qh.ox,a.Qh.Ns,a.Qh.Vl):oa(b)});z.V(this.R,"mousedown",function(a){oa(a)});z.V(this.R,"mouseover",function(){a.Th&&(a.R.style.color="#6688cc")});z.V(this.R,"mouseout",function(){a.Th&&(a.R.style.color="#000")})},yu:function(a){a&&(this.mh=a+"",this.ns&&(this.ns.innerHTML="<span>"+this.mh+"</span>"))},Xb:function(a){a&&(this.m.Vm=a,this.Tv?this.Tv.style.background="url("+a+")":(this.R.innerHTML= "<div"+(this.m.id?" id='"+this.m.id+"'":"")+" unselectable='on'><div style='width: 17px;height: 17px;margin-right: 3px;display: inline-block;zoom: 1;*display: inline;vertical-align: middle;background: url("+this.m.Vm+") no-repeat;'></div><span style='vertical-align: middle;'>"+this.mh+"</span></div>",this.Tv=this.R.firstChild,this.ns=this.R.lastChild))},enable:function(){this.Th=q;this.R&&(this.R.style.color="#000",this.R.style.cursor="pointer")},disable:function(){this.Th=t;this.R&&(this.R.style.color= "#aaa",this.R.style.cursor=this.P.M.Ac)}});V(mh,{setIcon:mh.Xb,setText:mh.yu,enable:mh.enable,disable:mh.disable}); 
